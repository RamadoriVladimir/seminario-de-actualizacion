<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Custom Element Example</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
</head>
<body>
</body>

<script>
	class XRequest extends HTMLElement {
		constructor() {
			super();

            this.tableHeaders = [
                { key: 'id', label: 'ID' },
                { key: 'username', label: 'Usuario' },
                { key: 'name', label: 'Nombre' },
                { key: 'email', label: 'Correo' },
                { key: 'website', label: 'Web' },
                { key: 'phone', label: 'Celular' }
            ];

			this.btn1 = document.createElement('button');
			this.outputTable = document.createElement('table');

			this.btn1.innerText = 'Efectuar peticiÃ³n';
			this.btn1.className = "w3-button w3-blue w3-margin";

			this.outputTable.className = "w3-table-all w3-hoverable w3-card-4 w3-margin-top";

            this.appendChild(this.btn1);
			this.appendChild(this.outputTable);
		}

		onButton1Click(event) {
            const xhr = new window.XMLHttpRequest();

            xhr.onload = () => this.handleResponse(xhr);
            xhr.onerror = () => this.handleError(xhr);

            xhr.open('GET', 'https://jsonplaceholder.typicode.com/users/');
            xhr.send();
		}

        handleResponse(xhr) {
            if (xhr.readyState !== 4 || xhr.status !== 200) {
                this.handleError(xhr);
                return;
            } 

            this.outputTable.textContent = '';
            const data = JSON.parse(xhr.responseText);

            const thead = this.createTableHeader(this.tableHeaders);
            const tbody = this.createTableBody(data, this.tableHeaders);

            this.outputTable.appendChild(thead);
            this.outputTable.appendChild(tbody);
        }

        handleError(xhr) {
            console.error(xhr.statusText);
        }

        createTableHeader(tableHeaders) {
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.className = "w3-teal";

            tableHeaders.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col.label;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            return thead;
        }
        
        createTableBody(data, tableHeaders) {
            const tbody = document.createElement('tbody');
            
            for (let item of data) {
                const tr = document.createElement('tr');

                tableHeaders.forEach(col => {
                    const td = this.createCell(col, item[col.key]);
                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            }
            return tbody;
        }

        createCell(col, value) {
            const td = document.createElement('td');
            this.stylizeCell(td, col, value);
            return td;
        }

        stylizeCell(td, col, value) {
            if (col.key === 'email') {
                const span = document.createElement('span');
                span.className = "w3-tag w3-round w3-light-blue w3-border w3-border-blue";
                span.textContent = value || '';
                td.appendChild(span);
            } else {
                td.textContent = value || '';
            }
        }

		connectedCallback() {
			this.btn1.onclick = this.onButton1Click.bind(this);
		}

        disconnectedCallback() {
            this.btn1.onclick = null;
        }
    }

	customElements.define('x-request', XRequest);

	function main() {
        let xrequest = new XRequest();
		document.body.appendChild(xrequest);
	}

	window.onload = main;
</script>
</html>
